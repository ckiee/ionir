version: 2
jobs:
  build:
    docker:
      - image: debian:stretch

    steps:
      - checkout

      - run:
          name: Update packages
          command: "apt-get update"

      - run:
          name: Install sudo
          command: "apt-get install -y sudo && rm -rf /var/lib/apt/lists/*"

      - run:
          name: Install GCC
          command: "sudo apt-get update && sudo apt-get install -y gcc g++"

      - run:
          name: Install wget
          command: "sudo apt-get install -y wget"

      - run:
          name: Download CMake
          command: "version=3.15 &&
                    build=4 &&
                    mkdir ~/temp &&
                    cd ~/temp &&
                    wget https://cmake.org/files/v$version/cmake-$version.$build.tar.gz &&
                    tar -xzvf cmake-$version.$build.tar.gz &&
                    cd cmake-$version.$build/"

      - run:
          name: Install CMake
          command: "./bootstrap &&
                    make -j$(nproc) &&
                    sudo make install"

      - run:
          name: Verify CMake
          command: "cmake --version"

      - run:
          name: Configure project
          command: "cmake --config Debug ."

      - run:
          name: Build project
          command: "cmake --build ."

      - run:
          name: Run tests
          command: "./test/Debug/IonIrTests"
